# üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Bitrix24

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é WhatsApp, **–Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è** –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–∞—à–µ–≥–æ –ø–æ—Ä—Ç–∞–ª–∞ Bitrix24.

## –ü—Ä–∏–Ω—Ü–∏–ø –∏–∑–æ–ª—è—Ü–∏–∏
–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤–∞ —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã:
1. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞**: `wamaxedu_whatsapp_dev` (–≤–º–µ—Å—Ç–æ –ø—Ä–æ–¥–∞–∫—à–Ω-–≤–µ—Ä—Å–∏–∏).
2. **–û—Ç–¥–µ–ª—å–Ω–∞—è –û—Ç–∫—Ä—ã—Ç–∞—è –ª–∏–Ω–∏—è**: –¢–µ—Å—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä.

---

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –¢–µ—Å—Ç–æ–≤–æ–π –û—Ç–∫—Ä—ã—Ç–æ–π –õ–∏–Ω–∏–∏
1. –ó–∞–π–¥–∏—Ç–µ –≤ **–ö–æ–Ω—Ç–∞–∫—Ç-—Ü–µ–Ω—Ç—Ä** –≤–∞—à–µ–≥–æ Bitrix24.
2. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—É—é –ª–∏–Ω–∏—é"** (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–°–ø–∏—Å–æ–∫", –∑–∞—Ç–µ–º "–°–æ–∑–¥–∞—Ç—å").
3. –ù–∞–∑–æ–≤–∏—Ç–µ –µ—ë: `[DEV] WhatsApp Test`.
4. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –æ—á–µ—Ä–µ–¥–∏ —É–∫–∞–∂–∏—Ç–µ **—Å–µ–±—è** –∫–∞–∫ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ (—á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ª–µ—Ç–µ–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º).
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ **–∑–∞–ø–æ–º–Ω–∏—Ç–µ ID —ç—Ç–æ–π –ª–∏–Ω–∏–∏** (–æ–Ω –≤–∏–¥–µ–Ω –≤ URL –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä `.../edit/4/`, ID = 4).

## –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ Webhook URL (–í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫)
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: `–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º` -> `–î—Ä—É–≥–æ–µ` -> `–í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫`.
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
   - `CRM` (crm) - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–∏–¥–æ–≤.
   - `–ß–∞—Ç –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è` (im) - –±–∞–∑–æ–≤—ã–π —á–∞—Ç.
   - `–û—Ç–∫—Ä—ã—Ç—ã–µ –ª–∏–Ω–∏–∏` (imopenlines) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–Ω–∏—è–º–∏.
   - `–ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ª–∏–Ω–∏–π` (imconnector) - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞—à–µ–≥–æ WhatsApp.
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–µ–±—Ö—É–∫ –¥–ª—è –≤—ã–∑–æ–≤–∞ REST API**.
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ (–Ω–∏–∫–æ–º—É –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ!).

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–í —Ñ–∞–π–ª–µ `d:\VsCode\WAmaxEdu\.env` —É–∫–∞–∂–∏—Ç–µ:

```env
# URL –≤–∞—à–µ–≥–æ –≤–µ–±—Ö—É–∫–∞ (–∏–∑ –®–∞–≥–∞ 2)
BITRIX24_WEBHOOK_URL=https://b24-xxxx.bitrix24.ru/rest/1/xxxxxxxxxxxx/

# ID –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ)
BITRIX24_CONNECTOR_ID=wamaxedu_whatsapp_dev

# ID —Ç–µ—Å—Ç–æ–≤–æ–π –ª–∏–Ω–∏–∏ (–∏–∑ –®–∞–≥–∞ 1)
BITRIX24_TEST_LINE_ID=4
```

*–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` —Å–µ—Ä–≤–∏—Å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å (–º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–µ–º).*

## –®–∞–≥ 4: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –≤ Bitrix24
–ù–∞—à —Å–µ—Ä–≤–∏—Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç "–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –≤ –≤–∞—à–µ–º –ë–∏—Ç—Ä–∏–∫—Å–µ.
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω: `npm run start:integrations`.
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å (–º–æ–∂–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å):
   ```bash
   curl -X POST http://localhost:3000/integrations/bitrix24/setup
   ```
   *–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç*:
   ```json
   {
     "success": true,
     "message": "Connector registered..."
   }
   ```
   *–¢–µ–ø–µ—Ä—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–æ–Ω—Ç–∞–∫—Ç-—Ü–µ–Ω—Ç—Ä" –ø–æ—è–≤–∏—Ç—Å—è –∏–∫–æ–Ω–∫–∞ "WAmaxEdu WhatsApp" (–≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É), –Ω–æ –æ–Ω–∞ –±—É–¥–µ—Ç **—Å–µ—Ä–æ–π** (–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π).*

## –®–∞–≥ 5: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–∞ –¢–µ—Å—Ç–æ–≤–æ–π –õ–∏–Ω–∏–∏
–ú—ã –ø—Ä–∏–≤—è–∂–µ–º –Ω–∞—à –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä **–¢–û–õ–¨–ö–û** –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –ª–∏–Ω–∏–∏ ‚Ññ4 (–≤–∞—à ID).
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:
   ```bash
   curl -X POST http://localhost:3000/integrations/bitrix24/activate \
     -H "Content-Type: application/json" \
     -d "{\"lineId\": \"4\"}"
   ```
   (–ó–∞–º–µ–Ω–∏—Ç–µ `4` –Ω–∞ –≤–∞—à ID –∏–∑ –®–∞–≥–∞ 1).

*–¢–µ–ø–µ—Ä—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ª–∏–Ω–∏–∏ `[DEV] WhatsApp Test` –Ω–∞—à –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —Å—Ç–∞–Ω–µ—Ç **–∞–∫—Ç–∏–≤–Ω—ã–º** (–∑–µ–ª–µ–Ω—ã–º).*

## –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ (–¢–µ—Å—Ç-–¥—Ä–∞–π–≤)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: WhatsApp -> Bitrix24
1. –í–æ–∑—å–º–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω (–Ω–µ —Ç–æ—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±–æ—Ç!).
2. –ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –Ω–æ–º–µ—Ä –±–æ—Ç–∞.
3. **–û–∂–∏–¥–∞–Ω–∏–µ**: –í –≤–∞—à–µ–º Bitrix24 –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è —á–∞—Ç –≤ –æ—Ç–∫—Ä—ã—Ç–æ–π –ª–∏–Ω–∏–∏ `[DEV] WhatsApp Test`.
4. –í CRM –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è –õ–∏–¥ (–µ—Å–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –Ω–µ—Ç).

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Bitrix24 -> WhatsApp
1. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä—è–º–æ –∏–∑ —á–∞—Ç–∞ Bitrix24.
2. **–û–∂–∏–¥–∞–Ω–∏–µ**: –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –Ω–∞ –≤–∞—à WhatsApp.

---

## üßπ –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –≤—Å—ë –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤?
–ï—Å–ª–∏ –≤—ã —Ä–µ—à–∏—Ç–µ —É–±—Ä–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:
1. –£–¥–∞–ª–∏—Ç–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —á–µ—Ä–µ–∑ API:
   (–î–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–π –≤—ã–∑–æ–≤ API –ë–∏—Ç—Ä–∏–∫—Å–∞ `imconnector.unregister` —Å ID `wamaxedu_whatsapp_dev`).
2. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç–µ –≤–µ–±—Ö—É–∫ –≤ –ë–∏—Ç—Ä–∏–∫—Å–µ -> –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
3. –£–¥–∞–ª–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –æ—Ç–∫—Ä—ã—Ç—É—é –ª–∏–Ω–∏—é.

**–í–∞—à –ø—Ä–æ–¥–∞–∫—à–Ω (–æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –ø—Ä–æ–¥–∞–∂) –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–ª–∏ —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏.**
